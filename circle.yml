machine:
  services:
    - docker
dependencies:
  cache_directories:
        - "~/docker"
        - "manuscripts/components/cache"
  override:
    - if [ -e ~/docker/container.tar ]; then docker load -i ~/docker/container.tar; else docker pull rocker/ropensci; fi

test:
  override:
    - docker run -ti -v $(pwd):/data -w /data rocker/ropensci r -e "devtools::check()"
    - docker run -ti -v $(pwd):/data -w /data rocker/ropensci r -e "rmarkdown::render('manuscripts/manuscript.Rmd')"
    # If no cache exists, cache container now to avoid downloading it next time
    - if [ ! -e ~/docker/container.tar ]; then mkdir ~/docker && docker save -o ~/docker/container.tar rocker/ropensci; fi


